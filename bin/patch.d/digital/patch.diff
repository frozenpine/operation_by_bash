From 172f08b29aba2c51a4e9f91b9ee8108e7c2b3795 Mon Sep 17 00:00:00 2001
From: guilin <ligl@quantdo.com.cn>
Date: Wed, 15 May 2019 09:36:52 +0800
Subject: [PATCH] =?UTF-8?q?=E3=80=90=E4=BC=98=E5=8C=96=E3=80=91=E3=80=90?=
 =?UTF-8?q?=E3=80=91=E3=80=90=E9=A3=8E=E9=99=A9=E8=AE=BE=E7=BD=AE=E7=AD=89?=
 =?UTF-8?q?=E5=BE=85=E9=97=AE=E9=A2=98=E4=BF=AE=E5=A4=8D=E3=80=91=E3=80=90?=
 =?UTF-8?q?=E3=80=91?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 .../service/impl/RiskParamSetServiceImpl.java | 24 ++++++++++++-------
 .../service/impl/RiskPositionServiceImpl.java |  4 ++--
 2 files changed, 17 insertions(+), 11 deletions(-)

diff --git a/digital/digital-serviceimpl/src/main/java/com/quantdo/digital/risk/service/impl/RiskParamSetServiceImpl.java b/digital/digital-serviceimpl/src/main/java/com/quantdo/digital/risk/service/impl/RiskParamSetServiceImpl.java
index a72c722..1f3fb6c 100644
--- a/digital/digital-serviceimpl/src/main/java/com/quantdo/digital/risk/service/impl/RiskParamSetServiceImpl.java
+++ b/digital/digital-serviceimpl/src/main/java/com/quantdo/digital/risk/service/impl/RiskParamSetServiceImpl.java
@@ -187,15 +187,21 @@ public class RiskParamSetServiceImpl implements RiskParamSetService {
 
                 if(!oldOrderPrompt.getDirection().equals(index.getDirection()) || !oldOrderPrompt.getPromptFlag().equals(index.getPromptFlag()) ||
                          oldOrderPrompt.getPromptValue().compareTo(index.getPromptValue()) !=Constants.ZERO ){
-                    oldOrderPrompt.setNoticeStatus(NoticeStatusEnum.UPDATENOTICING.getValue());
-                    index.setNoticeStatus(NoticeStatusEnum.UPDATENOTICING.getValue());
-                    OrderPrompt tem =new OrderPrompt();
-                    BeanUtils.copyProperties(index,tem);
-                    tem.setOldId(oldOrderPrompt.getId());
-                    tem.setId(null);
-                    orderPromptDao.save(tem);
-                    orderPromptDao.updateById(oldOrderPrompt);
-                    temOrderPromptLists.add(tem);
+                    if( Constants.BUY.equals(index.getDirection())){
+                        oldOrderPrompt.setNoticeStatus(NoticeStatusEnum.UPDATENOTICING.getValue());
+                        index.setNoticeStatus(NoticeStatusEnum.UPDATENOTICING.getValue());
+                        OrderPrompt tem =new OrderPrompt();
+                        BeanUtils.copyProperties(index,tem);
+                        tem.setOldId(oldOrderPrompt.getId());
+                        tem.setId(null);
+                        orderPromptDao.save(tem);
+                        orderPromptDao.updateById(oldOrderPrompt);
+                        temOrderPromptLists.add(tem);
+                    } else {
+                        oldOrderPrompt.setPromptValue(index.getPromptValue());
+                        orderPromptDao.updateById(oldOrderPrompt);
+                    }
+
                 }
             }
             for (OrderPrompt index: temOrderPromptLists) {
diff --git a/digital/digital-serviceimpl/src/main/java/com/quantdo/digital/risk/service/impl/RiskPositionServiceImpl.java b/digital/digital-serviceimpl/src/main/java/com/quantdo/digital/risk/service/impl/RiskPositionServiceImpl.java
index acb6571..11f8d09 100644
--- a/digital/digital-serviceimpl/src/main/java/com/quantdo/digital/risk/service/impl/RiskPositionServiceImpl.java
+++ b/digital/digital-serviceimpl/src/main/java/com/quantdo/digital/risk/service/impl/RiskPositionServiceImpl.java
@@ -363,9 +363,9 @@ public class RiskPositionServiceImpl implements RiskPositionService {
             positionModels.add(pos);
         }
         positionModels = positionModels.stream().sorted(Comparator.comparing(PositionModel::getLeverage).reversed()).collect(Collectors.toList());
-        for(int i = 1;i <= positionModels.size();i++){
+        for(int i = 0;i < positionModels.size();i++){
             PositionModel positionModel = positionModels.get(i);
-            positionModel.setLeverageOrder(i);
+            positionModel.setLeverageOrder(i+1);
         }
         return positionModels;
     }
-- 
2.21.0.windows.1

